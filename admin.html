<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Volunteer Admin View</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 30px;
      background-color: #f4f4f4;
    }
    h1, h2 {
      text-align: center;
    }
    .checkbox-group {
      text-align: center;
      margin-bottom: 20px;
    }
    .role-section {
      margin-bottom: 40px;
    }
    .signup-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    .signup-table th, .signup-table td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    .signup-table th {
      background-color: #eee;
    }
    .delete-button {
      background-color: red;
      color: white;
      border: none;
      padding: 4px 8px;
      cursor: pointer;
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body>
  <h1>Volunteer Admin Viewer</h1>
  <div class="checkbox-group" id="checkboxGroup"></div>
  <div id="adminDisplay"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBxXksGZlaonPGo2iIeJFy31dNlzGQ9Ze4",
      authDomain: "sedistricts.firebaseapp.com",
      databaseURL: "https://sedistricts-default-rtdb.firebaseio.com",
      projectId: "sedistricts",
      storageBucket: "sedistricts.appspot.com",
      messagingSenderId: "82368811038",
      appId: "1:82368811038:web:1adf8236c205910b675e0f"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const volunteerRoles = {
      "Set Up": 20,
      "Check In": 10,
      "Merchandise": 3,
      "Medals": 2,
      "Check In Saturday": 10,
      "Merchandise Saturday": 3,
      "Medals Saturday": 2,
      "Check In Saturday Evening": 4,
      "Merchandise Saturday Evening": 3,
      "Medals Saturday Evening": 2,
      "Break Down": 15
    };

    const adminDisplay = document.getElementById('adminDisplay');
    const checkboxGroup = document.getElementById('checkboxGroup');

    function renderCheckboxes() {
      Object.keys(volunteerRoles).forEach(role => {
        const label = document.createElement('label');
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.value = role.replace(/\s+/g, '_');
        checkbox.checked = true;
        checkbox.onchange = renderAdminView;
        label.appendChild(checkbox);
        label.append(` ${role} `);
        checkboxGroup.appendChild(label);
      });
    }

    function renderAdminView() {
      adminDisplay.innerHTML = '';
      const selectedRoleIds = Array.from(checkboxGroup.querySelectorAll('input:checked')).map(cb => cb.value);
      const roleMap = Object.keys(volunteerRoles).reduce((map, role) => {
        map[role.replace(/\s+/g, '_')] = role;
        return map;
      }, {});

      selectedRoleIds.forEach(roleId => {
        const role = roleMap[roleId];
        const roleSection = document.createElement('div');
        roleSection.className = 'role-section';

        const title = document.createElement('h2');
        title.innerText = role;
        roleSection.appendChild(title);

        const table = document.createElement('table');
        table.className = 'signup-table';
        table.innerHTML = `
          <tr>
            <th>Name</th><th>Age</th><th>School</th><th>Contact</th><th>Email</th><th>Action</th>
          </tr>
        `;

        db.ref('volunteerSlots/' + roleId).once('value').then(snapshot => {
          const signups = snapshot.val();
          if (signups) {
            Object.entries(signups).forEach(([key, person]) => {
              const row = document.createElement('tr');
              row.innerHTML = `
                <td>${person.name || ''}</td>
                <td>${person.age || ''}</td>
                <td>${person.school || ''}</td>
                <td>${person.contact || ''}</td>
                <td>${person.email || ''}</td>
                <td><button class="delete-button" onclick="deleteSignup('${roleId}', '${key}')">Delete</button></td>
              `;
              table.appendChild(row);
            });
          } else {
            const row = document.createElement('tr');
            row.innerHTML = '<td colspan="6">No signups yet.</td>';
            table.appendChild(row);
          }
        });

        roleSection.appendChild(table);
        adminDisplay.appendChild(roleSection);
      });
    }

    function deleteSignup(roleId, key) {
      if (confirm('Are you sure you want to delete this signup?')) {
        db.ref(`volunteerSlots/${roleId}/${key}`).remove().then(() => {
          renderAdminView();
        });
      }
    }

    window.onload = () => {
      renderCheckboxes();
      renderAdminView();
    };
  </script>
</body>
</html>
